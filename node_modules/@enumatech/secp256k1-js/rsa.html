<!DOCTYPE html>
<html>
    <head>
        <title>RSA demo</title>
        <style>
            input {
                width: 40em;
                text-align:right;
            }
        </style>
    </head>
    <body>
        <div><label for="p">p=</label><input id="p" type="number" size="200" min="3" value="61"><button id="rnd_p">rnd</button></div>
        <div><label for="q">q=</label><input id="q" type="number" size="200" min="3" value="53"><button id="rnd_q">rnd</button></div>
        <div><label for="n">n=</label><input id="n" type="number" size="200" readonly></div>
        <div><label for="e">e=</label><input id="e" type="number" min="3" value="17"><button id="rnd_e">rnd</button></div>
        <div><label for="d">d=</label><input id="d" type="number" size="200" readonly></div>
        <div><label for="m">m=</label><input id="m" type="number" size="200" min="0" value="65"></div>
        <div><label for="c">c=</label><input id="c" type="number" size="200" readonly></div>
        <div><label for="mp">m'=</label><input id="mp" type="number" size="200" readonly></div>
        <script src="https://unpkg.com/bn.js@4.11.8/lib/bn.js" type="text/javascript"></script>
        <script src="https://unpkg.com/rxjs@5.5.10/bundles/Rx.min.js" type="text/javascript"></script>
        <script>
            (() => {

                function fromEventValue(dom, event = 'input') {
                    let o = Rx.Observable.fromEvent(dom, event).map(e => e.target.value)
                    return dom.value !== "" ? o.startWith(dom.value) : o
                }

                function isPrime(bn) {
                    var b = bn.clone()
                    b.sqt
                }

                const lcm = (_a, _b) =>  _a.mul(_b).div(_a.gcd(_b))

                const [_p, _q, _n, _d, _m, _e, _mp, _c, _rnd_p, _rnd_q, _rnd_e] =
                    ['#p', '#q', '#n', '#d', '#m', '#e', '#mp', '#c', '#rnd_p', '#rnd_q', '#rnd_e']
                        .map(e => document.querySelector(e))

                Rx.Observable.fromEvent(_rnd_p, "click").map()
                    .subscribe(() => {
                        _p.value =
                    })

                Rx.Observable.combineLatest(fromEventValue(_e), fromEventValue(_p), fromEventValue(_q))
                    .subscribe(([e,p,q]) => {
                        const _lcm = lcm(new BN(p).subn(1), new BN(q).subn(1))
                        _d.value = new BN(e).invm(_lcm).toString()
                        _d.dispatchEvent(new Event('input'))
                    })

                Rx.Observable.combineLatest(fromEventValue(_p), fromEventValue(_q))
                    .subscribe(([p,q]) => {
                        _n.value = new BN(p).mul(new BN(q)).toString()
                        _n.dispatchEvent(new Event('input'))
                    })

                Rx.Observable.combineLatest(fromEventValue(_n), fromEventValue(_e), fromEventValue(_m))
                    .subscribe(([n,e,m]) => {
                        _c.value = new BN(m).pow(new BN(e)).mod(new BN(n)).toString()
                        _c.dispatchEvent(new Event('input'))
                    })

                Rx.Observable.combineLatest(fromEventValue(_c), fromEventValue(_d), fromEventValue(_n))
                    .subscribe(([c,d,n]) => {
                        _mp.value = new BN(c).pow(new BN(d)).mod(new BN(n)).toString()
                        _mp.dispatchEvent(new Event('input'))
                    })
            })()
        </script>
    </body>
</html>